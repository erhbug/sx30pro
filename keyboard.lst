C51 COMPILER V7.50   KEYBOARD                                                              09/14/2022 18:31:34 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE KEYBOARD
OBJECT MODULE PLACED IN keyboard.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE customer\keyboard.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\keyboard.lst) O
                    -BJECT(keyboard.obj)

line level    source

   1          //*************************************************************************//
   2          //* Name                                :   display_cal.c
   3          //* Vision                              :       V-Nov07_12
   4          //* Project                             :   All project
   5          //* Function                    :   Solidic 电子称 显存计算文件
   6          //* $Author                             :   superc
   7          //*
   8          //* Copyright 2012 by solidic
   9          //*
  10          //* Recode:
  11          //*                                             1: 2012-11-07  First Creat By Superc
  12          //*
  13          //*
  14          //*
  15          //*************************************************************************//
  16          #include <REG52.H>
  17          #include <math.h>
  18          //**************************************************************************
  19          // -- 全部头文件 集中管理 ---- ，版本修改文件名会变动 ---  必须修改 这个文件
  20          //**************************************************************************
  21          //#include "./_solidic/head_file_version.h"
  22          #include "./customer/keyboard.h"
  23          
  24          extern unsigned char Key;
  25          unsigned char LastKey;
  26          unsigned char KeyState=0;
  27          
  28          
  29          #define KEY_D0_ON                               P2 |= 0x02 
  30          #define KEY_D0_OFF                      P2 &= 0xFD 
  31          
  32          void delay_ms(unsigned int num)
  33          {       
  34   1              unsigned int i,j;
  35   1              for(i= 0;i<num;i++)     //(SDI5219) ??1ms
  36   1                      for(j=0;j<164;j++)
  37   1                              ;
  38   1      }
  39          
  40          void key_scan(void) {
  41   1        char k = 0;
  42   1        Key = 0;
  43   1      
  44   1        for (k = 0; k < 5; k++) {
  45   2          KEY_D0 = 1;
  46   2          KEY_D1 = 1;
  47   2          KEY_D2 = 1;
  48   2          KEY_D3 = 1;
  49   2          KEY_D4 = 1;
  50   2          if (k == 0) KEY_D0 = 0;
  51   2          if (k == 1) KEY_D1 = 0;
  52   2          if (k == 2) KEY_D2 = 0;
  53   2          if (k == 3) KEY_D3 = 0;
  54   2          if (k == 4) KEY_D4 = 0;
C51 COMPILER V7.50   KEYBOARD                                                              09/14/2022 18:31:34 PAGE 2   

  55   2          delay_ms(1);
  56   2          if (KEY_K0 != 1) Key = 1 + (k * 4);
  57   2          if (KEY_K1 != 1) Key = 2 + (k * 4);
  58   2          if (KEY_K2 != 1) Key = 3 + (k * 4);
  59   2          if (KEY_K3 != 1) Key = 4 + (k * 4);
  60   2        }
  61   1      
  62   1        if (LastKey == 0 && Key != 0) {
  63   2          KeyState = PRESS; //se presiono
  64   2        } else if (LastKey == Key && Key != 0) {
  65   2          KeyState = PRESSED; //se mantiene presionado
  66   2        } else if (LastKey != 0 && Key == 0) {
  67   2          KeyState = RELEASE; //se solto
  68   2        } else if (LastKey == 0 && Key == 0) {
  69   2          KeyState = 0; //no se ha presionado una tecla
  70   2        }
  71   1        LastKey = Key;
  72   1      }
  73          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    230    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
